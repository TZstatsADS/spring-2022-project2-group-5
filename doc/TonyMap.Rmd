---
title: "map"
author: "Tony"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(dplyr)
library(rworldmap)
library(rgdal)
library(ggplot2)
library(RSocrata)
library(ggspatial)
```

```{r read_data, message=F, warning=F}
homeless_tidy <- read.csv("../data/homeless_tidy.csv")
# df <- read.socrata(
#   "https://data.cityofnewyork.us/resource/ur7y-ziyb.json",
#   app_token = "IKAeRZx0jHfj8qD1SvDGxHGsx",
#   email     = "hz2694@columbia.edu",
#   password  = "9N6nrWC*y5#3zwG"
# )
```

```{r map, message=F, warning=F}
# worldMap <- getMap(resolution = "high")
# country <- c("United States")
# ind <- which(worldMap$NAME %in% country)
homeless_tidy %>%
  select(date, count, BoroCD) %>%
  filter(date == as.Date("2020-03-31"))-> homeless


nycd <- "../data/nycd_21d/nycd.shp"
# nycdwi <- "../data/nycdwi_21d/nycdwi.shp"
nycd_shp <- readOGR(dsn = nycd, stringsAsFactors = F)

df <- merge(nycd_shp, homeless, by.x = "BoroCD", by.y = "BoroCD") # join data set
# nycdwi_shp <- readOGR(dsn = nycdwi, stringsAsFactors = F)
nycd_map <- ggplot() +
  geom_polygon(data = df, aes(x = long, y = lat, group = group, colour = "black"))
# nycdwi_map <- ggplot() +
#   geom_polygon(data = nycdwi_shp, aes(x = long, y = lat, group = group), colour = "black", fill = NA)

nycd_map <- ggplot() +
   annotation_spatial(df) +
  layer_spatial(df, aes(fill = count))

nycd_map
# nycdwi_map + theme_void()
```